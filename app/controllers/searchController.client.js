'use strict';var timer,$btn=$('#searchBtn'),goingText='&nbsp;<i class="fa fa-2x fa-star"></i>&nbsp;Going!</a>',attendText='Attend&nbsp;<i class="fa fa-2x fa-star-o"></i></a>',lastSearch='';function displayBusinesses(a){var b=JSON.parse(a);$('#results').empty(),clearTimeout(timer),b.forEach(function(a,b){var c=(6.21371192e-4*a.distance).toFixed(1),d=a.image_url?a.image_url:'/public/img/blank.png';setTimeout(function(){$('#results').append('\n        <div class="col m6 l4 card-div animated fadeIn">\n          <div class="card small black">\n            <div class="card-image waves-effect waves-block waves-light">\n              <img class="activator business-img" src="'+d+'" alt="'+a.name+'">\n            </div>\n            <div class="card-content black">\n              <span class="card-title activator white-text">'+a.name+'<i class="material-icons right">more_vert</i></span>\n              <p>'+c+' mi.</p>\n              <p class="btm-right-text"><a class="attend-link right hidden" id="'+a.id+'" href="javascript:;" onclick="attend(this, true)">'+attendText+'</a></p>\n            </div>\n            <div class="card-reveal black">\n              <span class="card-title white-text">'+a.name+'\n              <i class="material-icons right">close</i></span>\n              <p>'+a.location.display_address.join('<br>')+'\n                  <br><a href="tel:'+a.phone+'" target="_blank">'+a.display_phone+'</a>\n              </p>\n              <p><a class="yelp" href="'+a.url+'" target="_blank">View on <img class="yelp-logo" src="/public/img/yelp.png" alt="Yelp"></a></p>\n              <p class="attendance"><span id="'+a.id+'-attendance">0</span>&nbsp;going</p>\n            </div>\n          </div>\n        </div>\n      ')},80*b)}),setTimeout(function(){checkAll(),$('.progress').addClass('hidden'),$btn.removeClass('disabled'),$btn.html('Search')},100*b.length)}function search(a){return!a.trim()||a.match(/[^a-zA-Z0-9.,\-\s]/)?Materialize.toast('Please enter a valid location',3e3,'error'):a.trim().toLowerCase()===lastSearch?Materialize.toast('Please enter a new location',3e3,'error'):void($('.card-div').addClass('fadeOut'),$('.progress').removeClass('hidden'),$btn.addClass('disabled'),$btn.html('<i class="fa fa-spinner fa-spin fa-fw"></i>'),ajaxFunctions.ajaxRequest('GET','/api/list/'+a,displayBusinesses),lastSearch=a.trim().toLowerCase(),timer=setTimeout(function(){Materialize.toast('Search took too long. Please try again.',3e3,'error'),lastSearch='',$('#locationInput').val(''),$('.progress').addClass('hidden'),$btn.removeClass('disabled'),$btn.html('Search')},7e3))}function checkAll(){var a=localStorage.getItem('rv-nightlife-id')||null;$('.attend-link').each(function(){var b=this;ajaxFunctions.ajaxRequest('GET','/api/attend/'+$(this)[0].id+'/'+a,function(c){var d=JSON.parse(c);if(!d)return $(b).addClass('animated fadeInUp').removeClass('hidden');var e=d.attendees.includes(a)?'attending':'no';updateAttending({location:d.location,total:d.attendees.length,action:e})})})}function updateAttending(a){var b='string'==typeof a?JSON.parse(a):a,c=$('#'+b.location);'attending'===b.action?(c.html(goingText),c.attr('onclick','attend(this)')):(c.html(attendText),c.attr('onclick','attend(this, true)')),c.addClass('animated fadeInUp').removeClass('hidden'),$('#'+b.location+'-attendance').html(b.total)}function attend(a,b){var c=localStorage.getItem('rv-nightlife-id');if(!c)return $('.fb-buttons').addClass('shake'),setTimeout(function(){return $('.fb-buttons').removeClass('shake')},1e3),Materialize.toast('Please log in to attend events',2e3,'error');var d=b?'PUT':'DELETE';ajaxFunctions.ajaxRequest(d,'/api/attend/'+a.getAttribute('id')+'/'+c,updateAttending)}$btn.click(function(){return search($('#locationInput').val())}),$('#locationForm').on('submit',function(a){a.preventDefault(),search($('#locationInput').val())});